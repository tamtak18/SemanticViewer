# 詳細設計書

## 1. 概要
本プログラムは、UCI機械学習リポジトリの心臓病データセット（Clevelandデータ）を用いて、決定木モデルによる心臓病の有無の分類を行うものです。データの前処理からモデルの学習、評価、そして決定木の可視化までを一連の流れで実施します。

---

## 2. 使用ライブラリ
- `pandas`：データの読み込みおよび前処理に使用します。
- `scikit-learn`：
  - `train_test_split`：データの分割に使用します。
  - `DecisionTreeClassifier`：決定木モデルの構築に使用します。
  - `classification_report`, `confusion_matrix`：モデル評価指標の算出に使用します。
  - `tree`：決定木の可視化に使用します。
- `matplotlib.pyplot`：決定木の図示に使用します。

---

## 3. 処理の詳細

### 3.1 データの読み込み
- URLからCSV形式の心臓病データを読み込みます。
- 列名は以下の14項目で指定します。
  - `age`：年齢
  - `sex`：性別
  - `cp`：胸痛の種類
  - `trestbps`：安静時血圧
  - `chol`：血清コレステロール
  - `fbs`：空腹時血糖
  - `restecg`：安静時心電図結果
  - `thalach`：最大心拍数
  - `exang`：運動誘発狭心症
  - `oldpeak`：運動によるST低下
  - `slope`：STの傾き
  - `ca`：主要血管の数（0-3）
  - `thal`：サラセミアの種類
  - `target`：心臓病の有無（目的変数）

### 3.2 欠損値処理
- データ中の`'?'`を`pandas.NA`に置換し、欠損値として扱います。
- 欠損値を含む行をすべて削除します。

### 3.3 データの前処理
- 説明変数`X`は`target`列を除いた全ての列とします。
- 目的変数`y`は`target`列とします。
- `X`のデータ型を`float`型に変換します。
- `y`のデータ型を`int`型に変換します。

### 3.4 データの分割
- データをトレーニングセット（80%）とテストセット（20%）に分割します。
- 乱数シードは42に固定し、再現性を確保します。

### 3.5 モデル構築
- 決定木分類器`DecisionTreeClassifier`を用います。
- ハイパーパラメータとして`max_depth=7`を設定し、過学習を抑制します。
- 乱数シードは42に固定します。
- トレーニングデータを用いてモデルを学習します。

### 3.6 モデルの予測
- テストデータに対して学習済みモデルで予測を行います。

### 3.7 モデルの評価
- 混同行列（Confusion Matrix）を表示し、分類結果の詳細を確認します。
- 精度、適合率、再現率、F1スコアなどを含む分類レポートを表示します。

### 3.8 決定木の可視化
- 学習済み決定木モデルを図示します。
- 特徴量名は`X`のカラム名を使用します。
- クラス名はモデルのクラスラベルから動的に取得し、ラベルとして表示します。
- 図のサイズは横20インチ、縦10インチに設定し、見やすくしています。
- 決定木のノードは色分け（filled=True）され、視覚的に判別しやすくしています。

### 3.9 データの表示
- 元データの先頭100行を表示します（Jupyter Notebook等の環境での確認用）。

---

## 4. 入出力仕様

| 処理段階           | 入力                             | 出力                             |
|--------------------|---------------------------------|---------------------------------|
| データ読み込み     | URL（CSVファイル）               | DataFrame（欠損値含む）          |
| 欠損値処理         | DataFrame                       | 欠損値を除去したDataFrame        |
| データ分割         | DataFrame                       | X_train, X_test, y_train, y_test |
| モデル学習         | X_train, y_train                | 学習済み決定木モデル             |
| 予測               | X_test                         | y_pred（予測ラベル）             |
| 評価               | y_test, y_pred                 | 混同行列、分類レポート           |
| 可視化             | 学習済みモデル、特徴量名、クラス名 | 決定木の図示                     |
| データ表示         | DataFrame                      | 先頭100行のデータ表示            |

---

## 5. 注意事項
- データ中の`'?'`は欠損値として扱うため、適切に置換および削除を行っていますが、欠損値の多い場合はデータ数が大幅に減少する可能性があります。
- 決定木の深さ`max_depth=7`は過学習を防ぐための設定ですが、データの特性に応じて調整が必要です。
- 可視化はJupyter Notebookなどのインタラクティブ環境での表示を想定しています。スクリプト実行環境によっては表示方法を変更する必要があります。

---

## 6. まとめ
本プログラムは、心臓病データセットを用いて決定木モデルを構築し、分類性能を評価、さらに決定木の構造を可視化する一連の処理を実装しています。データの前処理からモデル評価まで丁寧に行うことで、機械学習の基本的な流れを理解しやすい構成となっています。